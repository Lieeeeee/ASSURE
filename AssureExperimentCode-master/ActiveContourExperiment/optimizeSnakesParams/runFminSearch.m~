%% use fminsearch in order to find a local minima of the Pve

% previous good params, resulted in loss of 0.0523!
initial_population = [2.5451    0.0334    2.1619    0.0088    0.1600    0.1711   -0.5740    2.3761    3.5504   -0.0586   -2.0904   -0.0071    0.1349    0.2608    0.4343    3.0997];

options = optimset('Display','iter');

[x, fval] = fminsearch(@getPveBasedLoss, initial_population, options);

%% save resulting experiment
experiment_folder = '/cs/casmip/clara.herscu/git/thesis/figs/snakes_jan18/experiment_040118/';
load('chapter3Env.mat');
imgCell = lungImgCell3D;
% prepare the parameters for the experiment
kernelSize = 2; Tlength = 3;
SNAKE_RUN = 2;
TRIVIAL_RUN = 0;
SEGNUM_TO_USE = 0;
DEBUG = false;
% create an Options struct for in and out
iterIn = x(1); WlIn = x(2); WeIn = x(3); WtIn = x(4); alIn = x(5); beIn = x(6); delIn = x(7); kapIn = x(8);
iterOut = x(9); WlOut = x(10); WeOut = params(11); WtOut = params(12); alOut = params(13); beOut = params(14); delOut = params(15); kapOut = params(16);
OptionsIn = SnakeOptions.getSpecifiedOptions(DEBUG, iterIn, WlIn, WeIn, WtIn, alIn, beIn, delIn, kapIn);
OptionsOut = SnakeOptions.getSpecifiedOptions(DEBUG, iterOut, WlOut, WeOut, WtOut, alOut, beOut, delOut, kapOut);